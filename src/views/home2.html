<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrashFlow - Conectando você à reciclagem</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./public/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./public/css/home.css">
</head>

<body>
    <div id="home" class="container">
        <header>
            <div class="logo">
                <img src="./public/TrashflowLogo 2.png" alt="TrashFlow Logo">
            </div>
            <div class="navbar">
                <ul>
                    <li>Quem somos</li>
                    <li>Ideias de Reciclagem</li>
                    <li>Empresas cadastradas</li>
                    <li>Contato</li>
                </ul>
            </div>

            <div class="user-menu-container">
                <div class="user-icon-wrapper">
                    <svg width="56" height="56" viewBox="0 0 36 36" fill="#4a9c0d" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M29.3,33.8h-2,0s-20.6,0-20.6,0c-1.4,0-2.6-.5-3.5-1.5-.8-.9-1.1-2.1-1-3.3l.2-1.3c.3-1.9,2-3.4,4.3-4l11.4-1.9h0s10.9,1.9,10.9,1.9c2.5.6,4,2,4.4,3.9l.2,1.3c.2,1.2-.2,2.4-1,3.3-.8,1-2.1,1.5-3.5,1.5ZM18,23.2l-10.9,1.9c-1.3.3-2.9,1.2-3.1,2.7l-.2,1.3c-.1.8.1,1.5.6,2.1.6.6,1.4,1,2.4,1h22.9c.8,0,1.5-.4,2-1,.5-.6.7-1.3.6-2.1l-.2-1.3c-.3-1.8-2.3-2.5-3.2-2.7l-10.9-1.9ZM18,18.8c-2.2,0-4.3-.9-5.8-2.4s-2.4-3.6-2.4-5.8.9-4.3,2.4-5.8c1.6-1.6,3.6-2.4,5.8-2.4s4.3.9,5.8,2.4c1.6,1.6,2.4,3.6,2.4,5.8s-.9,4.3-2.4,5.8c-1.6,1.6-3.6,2.4-5.8,2.4ZM18,3.8c-1.8,0-3.5.7-4.8,2-1.3,1.3-2,3-2,4.8s.7,3.5,2,4.8,3,2,4.8,2,3.5-.7,4.8-2c1.3-1.3,2-3,2-4.8s-.7-3.5-2-4.8c-1.3-1.3-3-2-4.8-2Z" />
                    </svg>
                </div>
                <div class="user-dropdown">
                    <div class="dropdown-item" data-action="login">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Entrar</span>
                    </div>
                    <div class="dropdown-item" data-action="cadastro">
                        <i class="fas fa-user-plus"></i>
                        <span>Cadastrar</span>
                    </div>
                    <div class="dropdown-item" data-action="perfil">
                        <i class="fas fa-user"></i>
                        <span>Meu perfil</span>
                    </div>
                    <div class="dropdown-item" data-action="logout">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Deslogar</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Resto do conteúdo permanece igual -->
        <!-- Hero Section Modernizada -->
        <section class="hero">
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <h1>Transforme seu lixo em solução</h1>
                <p class="hero-subtitle">Encontre os melhores locais para descarte ecológico e descubra como pequenas
                    ações podem gerar grandes impactos ambientais.</p>
                <button class="hero-cta">Comece agora</button>
            </div>
        </section>

        <!-- Main Content -->
        <section class="main-content">
            <div class="content-container">
                <h2 class="section-title">Tenha acesso a locais de descarte e ideias criativas de reciclagem</h2>

                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <h3>Locais de coleta</h3>
                        <p>Encontre os pontos de coleta mais próximos de você para diversos tipos de materiais
                            recicláveis.</p>
                        <button class="feature-button">Explorar locais</button>
                    </div>

                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <h3>Ideias sustentáveis</h3>
                        <p>Descubra como transformar resíduos em objetos úteis e decorativos com nossas ideias
                            criativas.</p>
                        <button class="feature-button">Ver ideias</button>
                    </div>

                    <div class="feature-image">
                        <img src="./public/RECICLOOO 1.png" alt="Reciclagem criativa" class="animated-image">
                        <div class="image-overlay">
                            <p>Juntos podemos fazer a diferença!</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Info Section -->
        <section class="info-section">
            <div class="info-overlay"></div>
            <div class="info-content">
                <h2>Por que reciclar é importante?</h2>
                <p class="info-text">Cada tonelada de papel reciclado poupa 22 árvores, consome 71% menos energia
                    elétrica e representa 74% menos poluição do ar.</p>
                <div class="info-stats">
                    <div class="stat-item">
                        <span class="stat-number">80%</span>
                        <span class="stat-label">Redução de resíduos em aterros</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">50x</span>
                        <span class="stat-label">Mais eficiente que coleta comum</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Carrossel de Ideias Dinâmico -->
        <section class="ideas-section">
            <div class="section-header">
                <h2>Inspire-se com nossas ideias de reciclagem</h2>
                <p class="section-subtitle">Descubra como transformar o que seria lixo em peças úteis e decorativas</p>
            </div>

            <div class="swiper ideas-swiper">
                <div class="swiper-wrapper" id="ideas-swiper-wrapper">
                    <!-- Slides serão inseridos dinamicamente via JavaScript -->
                    <div class="swiper-slide idea-slide">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                            <p>Carregando ideias...</p>
                        </div>
                    </div>
                </div>

                <div class="swiper-pagination"></div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section class="faq-section">
            <div class="faq-container">
                <h2>Perguntas Frequentes</h2>
                <p class="faq-subtitle">Tire suas dúvidas sobre reciclagem e nossa plataforma</p>

                <div class="faq-grid">
                    <details class="faq-item">
                        <summary>O que é reciclagem?</summary>
                        <div class="faq-content">
                            <p>A reciclagem é o processo de transformar resíduos em novos produtos, reduzindo o consumo
                                de matéria-prima e o impacto ambiental. Isso inclui coletar, separar e processar
                                materiais que seriam descartados como lixo para serem reintroduzidos no ciclo de
                                produção.</p>
                        </div>
                    </details>

                    <details class="faq-item">
                        <summary>Quais materiais podem ser reciclados?</summary>
                        <div class="faq-content">
                            <p>Materiais como papel, plástico, vidro e metal são comumente recicláveis, desde que
                                estejam limpos e secos. Alguns tipos específicos incluem: garrafas PET, latas de
                                alumínio, jornais, caixas de papelão, frascos de vidro e embalagens longa vida.</p>
                        </div>
                    </details>

                    <details class="faq-item">
                        <summary>Como a plataforma ajuda o meio ambiente?</summary>
                        <div class="faq-content">
                            <p>Nossa plataforma conecta usuários a iniciativas sustentáveis, promovendo ações de coleta
                                seletiva, reciclagem e educação ambiental. Facilitamos o encontro entre quem quer
                                descartar resíduos corretamente e quem pode transformá-los em novos produtos, reduzindo
                                o impacto ambiental.</p>
                        </div>
                    </details>

                    <details class="faq-item">
                        <summary>Como posso me cadastrar na plataforma?</summary>
                        <div class="faq-content">
                            <p>Você pode se cadastrar clicando no botão "Cadastrar" no menu principal e preenchendo o
                                formulário com suas informações básicas. O cadastro é rápido, gratuito e você ganha
                                acesso a todos os recursos da plataforma, incluindo localização de pontos de coleta e
                                ideias de reciclagem.</p>
                        </div>
                    </details>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="site-footer">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="./public/TrashflowLogo 2.png" alt="Trashflow Logo" width="120">
                    <p>Transformando resíduos em oportunidades desde 2020.</p>
                </div>
                <div class="footer-links">
                    <h4>Links Rápidos</h4>
                    <ul>
                        <li><a href="#">Quem somos</a></li>
                        <li><a href="#">Ideias de Reciclagem</a></li>
                        <li><a href="#">Empresas cadastradas</a></li>
                        <li><a href="#">Contato</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h4>Contato</h4>
                    <p><i class="fas fa-envelope"></i> contato@trashflow.com.br</p>
                    <p><i class="fas fa-phone"></i> (11) 98765-4321</p>
                    <div class="social-icons">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Trashflow. Todos os direitos reservados.</p>
            </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        // Função para extrair ID do YouTube
        function getYouTubeId(url) {
            if (!url) return null;

            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length === 11) ? match[7] : null;
        }

        // Carregar ideias para o carrossel
        async function loadIdeasForCarousel() {
            try {
                const response = await fetch('http://localhost:3030/dataideia');
                const ideas = await response.json();

                // Pegar as primeiras 4 ideias para o carrossel
                const carouselIdeas = ideas.slice(0, 4);
                displayCarouselIdeas(carouselIdeas);
            } catch (error) {
                console.error('Erro ao carregar ideias para o carrossel:', error);
                displayCarouselError();
            }
        }

        // Exibir ideias no carrossel
        function displayCarouselIdeas(ideas) {
            const wrapper = document.getElementById('ideas-swiper-wrapper');

            if (ideas.length === 0) {
                wrapper.innerHTML = `
                <div class="swiper-slide idea-slide">
                    <div class="no-ideas">
                        <i class="fas fa-lightbulb"></i>
                        <h3>Nenhuma ideia encontrada</h3>
                        <p>Em breve teremos novidades!</p>
                    </div>
                </div>
            `;
                return;
            }

            wrapper.innerHTML = ideas.map(idea => {
                const youtubeId = getYouTubeId(idea.url);
                const hasImage = idea.img && idea.img !== '/imagens/null';

                // Conteúdo da mídia (imagem ou iframe)
                let mediaContent = '';
                if (youtubeId) {
                    // Se tem URL do YouTube, mostra iframe
                    mediaContent = `
                    <div class="video-container">
                        <iframe 
                            src="https://www.youtube.com/embed/${youtubeId}" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                    </div>
                `;
                } else if (hasImage) {
                    // Se não tem URL mas tem imagem, mostra imagem
                    mediaContent = `<img src="${idea.img}" alt="${idea.titulo}" onerror="this.src='public/nick-fewings--2lJGRIY5P0-unsplash.jpg'">`;
                } else {
                    // Se não tem nenhum, mostra imagem padrão
                    mediaContent = `<img src="public/nick-fewings--2lJGRIY5P0-unsplash.jpg" alt="${idea.titulo}">`;
                }

                return `
                <div class="swiper-slide idea-slide">
                    ${mediaContent}
                    <div class="slide-content">
                        <h3>${idea.titulo}</h3>
                        <p>${idea.descricao.length > 100 ? idea.descricao.substring(0, 100) + '...' : idea.descricao}</p>
                        <div class="idea-meta">
                            <span><i class="fas fa-clock"></i> ${idea.tempo || 'Tempo variável'}</span>
                            <span><i class="fas fa-star"></i> ${idea.dificuldade || 'Fácil'}</span>
                        </div>
                        <button class="idea-button" onclick="window.location.href='/cadastroideia'">Ver mais</button>
                    </div>
                </div>
            `;
            }).join('');

            // Reinicializar o Swiper após adicionar os slides dinamicamente
            if (window.ideasSwiper) {
                window.ideasSwiper.update();
            }
        }

        // Exibir erro no carrossel
        function displayCarouselError() {
            const wrapper = document.getElementById('ideas-swiper-wrapper');
            wrapper.innerHTML = `
            <div class="swiper-slide idea-slide">
                <div class="carousel-error">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3>Erro ao carregar ideias</h3>
                    <p>Tente recarregar a página</p>
                </div>
            </div>
        `;
        }

        // Inicialização quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', function () {
            // Carregar ideias dinamicamente
            loadIdeasForCarousel();

            // Inicialização do Swiper
            window.ideasSwiper = new Swiper('.ideas-swiper', {
                slidesPerView: 1,
                spaceBetween: 20,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                breakpoints: {
                    768: {
                        slidesPerView: 2,
                    },
                    1024: {
                        slidesPerView: 3,
                    }
                },
                autoplay: {
                    delay: 5000,
                    disableOnInteraction: false,
                },
            });

            // Navegação dos itens do menu
            const listItems = document.getElementsByTagName('li');
            for (let i = 0; i < listItems.length; i++) {
                listItems[i].addEventListener('click', function (event) {
                    const text = event.target.textContent;
                    if (text === "Quem somos") {
                        window.location.href = "/sobre";
                    } else if (text === "Ideias de Reciclagem") {
                        window.location.href = "/cadastroideia";
                    } else if (text === "Empresas cadastradas") {
                        window.location.href = "/cadastroempresa";
                    } else if (text === "Contato") {
                        window.location.href = "/contato";
                    }
                });
            }

            document.querySelector('.logo').addEventListener('click', () => {
                window.location.href = "/";
            });

            // Menu dropdown do usuário
            const userIcon = document.querySelector('.user-icon-wrapper');
            const userDropdown = document.querySelector('.user-dropdown');

            // Abrir/fechar dropdown
            userIcon.addEventListener('click', function (e) {
                e.stopPropagation();
                userDropdown.classList.toggle('active');
            });

            // Fechar dropdown ao clicar fora
            document.addEventListener('click', function () {
                userDropdown.classList.remove('active');
            });

            // Prevenir fechamento ao clicar dentro do dropdown
            userDropdown.addEventListener('click', function (e) {
                e.stopPropagation();
            });

            // Ações do dropdown
            document.querySelectorAll('.dropdown-item').forEach(item => {
                item.addEventListener('click', async function () {
                    const action = this.getAttribute('data-action');

                    if (action === "login") {
                        window.location.href = "/login";
                    } else if (action === "cadastro") {
                        window.location.href = "/cadastrar";
                    } else if (action === "logout") {
                        window.location.href = "/logout";
                    } else if (action === "perfil") {
                        try {
                            const resposta = await fetch('/obterusuario');
                            if (resposta.ok) {
                                window.location.href = "/perfil";
                            } else {
                                window.location.href = "/login";
                            }
                        } catch (erro) {
                            console.error("Erro ao verificar autenticação:", erro);
                            window.location.href = "/login";
                        }
                    }

                    // Fechar dropdown após seleção
                    userDropdown.classList.remove('active');
                });
            });

            document.querySelectorAll('.feature-button').forEach((btn, index) => {
                if (index === 0) {
                    btn.addEventListener('click', () => window.location.href = '/cadastroempresa');
                } else if (index === 1) {
                    btn.addEventListener('click', () => window.location.href = '/cadastroideia');
                }
            });

            document.querySelector('.hero-cta').addEventListener('click', () => {
                window.location.href = '/cadastrar';
            });
        });
    </script>
</body>

</html>